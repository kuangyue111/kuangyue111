/*==========================================Copyright(c)===========================================
**                                  Shenzhen Infypower Co., Ltd.
**                                  Power conversion Department
**                                       BMS Product Line
**
**---------------------------------------File Information------------------------------------------
** @File Name    : MbTriSend.h
** @Founder      : SBK326
** @Date         : 2019.11.1
** @Function     : Modbus通信包触发处理函数
** @Instructions :
**===============================================================================================*/
#ifndef _MBTRISEND_H
#define _MBTRISEND_H

/*=================================================================================================
** @Header file definition
**===============================================================================================*/
#include "MbUserDef.h"

/*=================================================================================================
** @Global variable definition
**===============================================================================================*/

/*=================================================================================================
** @Macro definition
**===============================================================================================*/
#define TRIG_SEND_NUM cTrigSendNum 	       	//设置默认触发发送信息数目

/*=================================================================================================
** @Data type definition
**===============================================================================================*/
//触发信息结构体定义
typedef struct
{
	u8 flag; 						        //触发标识，1表示触发，0表示未触发
	u16 cyc; 					            //周期
	u16 time; 				            	//计数器
	void (* fun)(void *); 		        	//触发函数
	void *arg; 				            	//函数参数
}sTriCycMsg;

/*=================================================================================================
** @Interface function declaration
**===============================================================================================*/
/*=================================================================================================
** @Name      : vvoid MbTrigSendTimerTask(void)
** @Input     : void
** @Output    : void
** @Function  : 触发信息发送计时任务
** @The notes : 2ms周期调用一次
**===============================================================================================*/
void MbTrigSendTimerTask(void);

/*=================================================================================================
** @Name      : u8 MbTrigSendMsgCfgAPI(u8 id, u16 cycle, void (*fun)(void *arg), void *arg)
** @Input     : id:触发信息通道号,cyc:触发信息周期1表示2ms,void (*fun)(void *arg)触发函数,*arg:触发函数参数
** @Output    : 配置结果:1:成功 0:失败
** @Function  : 触发函数发送信息配置
** @The notes : 初始化配置调用
**===============================================================================================*/
u8 MbTrigSendMsgCfgAPI(u8 id, u16 cycle, void (*fun)(void *arg), void *arg);

/*=================================================================================================
** @Name      : u8 MbSetTrigFlagStateAPI(u8 id, u8 flag)
** @Input     : id:触发信息通道号,flag:触发标识(0:不触发 1:触发)
** @Output    : 触发设置结果:1成功 0失败
** @Function  : 设置触发标识状态
** @The notes :
**===============================================================================================*/
u8 MbSetTrigFlagStateAPI(u8 id, u8 flag);

#endif

